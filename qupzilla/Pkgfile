# Description:  A lightweight multiplatform web browser written in Qt Framework and using its web rendering engine QtWebEngine.
# URL:         https://www.qupzilla.com/
# Maintainer:  onodera, https://github.com/onodra-punpun/crux-ports/issues
# Depends on:  qtwebengine git

name=qupzilla
version=git
release=1
source=(rice.patch)

build() {
	cd $PKGMK_SOURCE_DIR

	if cd $name-plugins; then
		git fetch -q; git reset --hard origin/master
	else
		git clone --depth=1 https://github.com/$name/$name-plugins $name-plugins
		cd $name-plugins
	fi
	cd ..

	if cd $name; then
		git fetch -q; git reset --hard origin/master
	else
		git clone --depth=1 https://github.com/$name/$name $name
		cd $name
	fi

	cp -r ../$name-plugins/plugins/* src/plugins
	cd src
	patch -p1 < $SRC/rice.patch
	cd ..

	export DISABLE_UPDATES_CHECK=true \
		QUPZILLA_PREFIX=/usr

	qmake-qt5
	make
	make INSTALL_ROOT=$PKG install
}
