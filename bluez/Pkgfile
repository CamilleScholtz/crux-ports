# Description: Daemons for the bluetooth protocol stack.
# URL:         http://www.bluez.org/
# Maintainer:  onodera, https://github.com/onodera-punpun/crux-ports/issues
# Depends on:  dbus alsa-lib libical

name=bluez
version=git
release=1
source=(
	#https://www.kernel.org/pub/linux/bluetooth/$name-$version.tar.xz
	bluetoothd
)

download_git() {
	if [[ -d $PKGMK_SOURCE_DIR/$name ]]; then
		git -C $PKGMK_SOURCE_DIR/$name fetch --depth=1
		git -C $PKGMK_SOURCE_DIR/$name clean -f
		git -C $PKGMK_SOURCE_DIR/$name reset --hard origin/$2
	else
		git -C $PKGMK_SOURCE_DIR clone --depth=1 $1 -b $2 $name
	fi

	cp -r $PKGMK_SOURCE_DIR/$name $PKGMK_WORK_DIR/src/$name
}

build() {
	download_git git://git.kernel.org/pub/scm/bluetooth/bluez.git master
	cd $name

	autoreconf -fi
	./configure \
		--prefix=/usr \
		--libexecdir=/usr/lib/ \
		--enable-experimental \
		--enable-tools \
		--enable-library \
		--enable-midi \
		--enable-a2dp \
		--disable-systemd

	make
	make DESTDIR=$PKG install

	install -Dm644 profiles/network/network.conf $PKG/etc/bluetooth/network.conf
	install -Dm644 profiles/input/input.conf $PKG/etc/bluetooth/input.conf

	install -Dm755 $SRC/bluetoothd $PKG/etc/rc.d/bluetoothd
	mkdir -p $PKG/var/run/bluetoothd
}
